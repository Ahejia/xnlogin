<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.xnlogin.mapper.UserGradeMapper" >
  <resultMap id="BaseResultMap" type="com.example.xnlogin.mess.UserGrade" >
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="user_id" property="userId" jdbcType="BIGINT" />
    <result column="datainfo" property="datainfo" jdbcType="VARCHAR" />
    <result column="operate_type" property="operateType" jdbcType="VARCHAR" />
    <result column="score" property="score" jdbcType="INTEGER" />
    <result column="timer" property="timer" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, user_id, datainfo,operate_type, score, timer, create_time
  </sql>
    <sql id="Base_Column_List1" >
    id, user_id,operate_type, score, timer,create_time
  </sql>
  <select id="getById" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    select 
    <include refid="Base_Column_List" />
    from user_grade
    where id = #{id,jdbcType=BIGINT}
  </select>
  <select id="getUserGradeById" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    select
    <include refid="Base_Column_List1" />
    from user_grade
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteById" parameterType="java.lang.Long" >
    delete from user_grade
    where id = #{id,jdbcType=BIGINT}
  </delete>

  <insert id="insert" parameterType="com.example.xnlogin.mess.UserGrade" >
    insert into user_grade
    <trim prefix="(" suffix=")" suffixOverrides="," >

      <if test="userId != null" >
        user_id,
      </if>
      <if test="datainfo != null" >
        datainfo,
      </if>
      <if test="operateType != null" >
        operate_type,
      </if>
      <if test="score != null" >
        score,
      </if>
      <if test="timer != null" >
        timer,
      </if>

    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >

      <if test="userId != null" >
        #{userId,jdbcType=BIGINT},
      </if>
      <if test="datainfo != null" >
        #{datainfo,jdbcType=VARCHAR},
      </if>
      <if test="operateType != null" >
        #{operateType,jdbcType=VARCHAR},
      </if>
      <if test="score != null" >
        #{score,jdbcType=INTEGER},
      </if>
      <if test="timer != null" >
        #{timer,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="update" parameterType="com.example.xnlogin.mess.UserGrade" >
    update user_grade
    <set >
      <if test="userId != null" >
        user_id = #{userId,jdbcType=BIGINT},
      </if>
      <if test="datainfo != null" >
        datainfo = #{datainfo,jdbcType=VARCHAR},
      </if>
      <if test="operateType != null" >
        operate_type = #{operateType,jdbcType=VARCHAR},
      </if>
      <if test="score != null" >
        score = #{score,jdbcType=INTEGER},
      </if>
      <if test="timer != null" >
        timer = #{timer,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>

  <!--用户编号查询数据-->
  <select id="getByUserIdAndTimer"  resultMap="BaseResultMap">
    select <include refid="Base_Column_List"/>
    from user_grade
    <where>
    <if test="userId != '' and userId > 0">and user_id = #{userId}</if>
    <if test="timer != null and timer != ''">and timer like concat ('%',#{timer},'%')</if>
    </where>
  </select>

  <!--获取超过30天的数据-->
  <select id="getSurplus" resultType="Long">
    select id from user_grade where create_time &lt; DATE_SUB(CURDATE(), INTERVAL 30 DAY)
  </select>

  <!--用户编号查询不同的时间-->
  <select id="getTimerByUserId" parameterType="java.lang.Long" resultType="String">
    select distinct(timer) from user_grade where user_id = #{userId}
  </select>

  <!--学号查询不同的时间-->
  <select id="getTimerByUnit" parameterType="java.lang.String" resultType="String">
    select distinct(timer) from user_grade where unit = #{unit}
  </select>

  <!--查询最后一条数据-->
  <select id="getLastMessageId" resultType="java.lang.Long">
    select max(id)
    from user_grade
    where user_id = #{userId} and timer = #{timer}
  </select>

</mapper>